#!/usr/bin/env perl
#   -Creates an *.html file for each input file that doesn't already have one,
#    converting from markdown.
#
#   USAGE: $0 *.mkd

use 5.012;
use Text::Markdown 'markdown';
use File::Basename;
use Template;

# CONFIG
my $template_file = "bin/html_template.tt";

print "Converting markdown files to HTML..\n";
my $tt = Template->new;
foreach (@ARGV){
	print "$_..\n";
    # Get HTML file name
    my ($basename) = fileparse($_, ".markdown");
	my $outfile = "$basename.html";
	if (-e $outfile) {
        print "\t$outfile exists.  Skipping.\n";
        next;
    };

    # Get contents of markdown file
    open my $input, $_;
    my $content = markdown(join '', <$input>);
    close $input;

    open my $output, ">$outfile";
    # Assemble and write HTML
    $tt->process($template_file, {
            pagename => $basename,
            content => $content
        },
        $output
    ) or die "Template Error: " . $tt->error();

    close $output;
}
