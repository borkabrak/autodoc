#!/usr/bin/env perl
# Convert markdown to HTML for the DiTool Documentation Project
#   -Creates an *.html file for each input file that doesn't already have one
#
#   USAGE: $0 *.mkd

use strict;
use Text::Markdown 'markdown';
use Template;

# CONFIG
my $template_file = "/home/jcarter/ditool/didoc/bin/html_template.ttk";

my $tt = Template->new;
foreach (@ARGV){
	print "Converting $_..\n";

    # Get HTML file name
    my ($basename,undef) = /(.*)(\..*)$/;
	my $outfile = "$basename.html";
	next if -e $outfile;

    # Get contents of markdown file
    open my $input, $_;
    my $content = join '', <$input>;
    close $input;

    open my $output, ">$outfile";
    # Assemble and write HTML
    $tt->process($template_file, {
            element_name => $basename,
            content => $content
        },
        $output
    ) or die "Template Error: " . $tt->error();

    close $output;
}

