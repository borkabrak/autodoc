#!/usr/bin/env perl
#
# Creates a 'pure markdown' file by running each argument through Template
# Tookit against the analysis results.
use strict;
use 5.012;
use File::Basename;
use JSON;
use Template;
my $ttk = Template->new;

# CONFIG
my $outdir = 'bin/markdown/';
my $specfile = 'bin/analysis.json';

#-- BEGIN ----------------------------------------------------------------------------
say "Creating KAML documentation..";

# Get spec data
open SPEC, $specfile or die "Can't open $specfile:$!";
my $spec = decode_json(join('',<SPEC>));

# Convert each file
for (@ARGV) {
    chomp;

    my $outfile = $outdir . basename($_);
    say "$_ -> $outfile";

    $ttk->process( $_, $spec, $outfile) || die $ttk->error();
}

say "..Done";
