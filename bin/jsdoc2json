#!/usr/bin/env ruby
#
#   Extend the JSON spec with jsdoc data from the given file.

require 'json'
require_relative 'jsdoc'

specfile = "analysis.json"

if (ARGV.length < 1) then
    puts "Usage: #{__FILE__} <sourcefile>"
    exit
end

puts "JSDoc scanning on #{specfile}.."

spec = JSON.parse(File.read(specfile))

sourcecode = File.read(ARGV[0]) or (abort("Can't open #{ARGV[0]}"))

spec[:jsdoc] = JSDoc.new(sourcecode).spec

File.write(specfile, "#{JSON.pretty_generate(spec)}\n")
puts "Spec written to #{specfile}."
